# üîß JSON Error Troubleshooting Guide - VAULT MK8

## Quick Diagnosis Steps

### 1. ‚úÖ Check Your Setup
- [ ] Is n8n running? (Check if `http://localhost:5678` works)
- [ ] Is the workflow imported and active?
- [ ] Does the webhook URL match? (Should be: `http://localhost:5678/webhook/vault-mk8-command`)

### 2. üîç Common JSON Error Causes

#### **Empty Response**
- **Symptom**: "Backend bo≈ü cevap verdi"
- **Cause**: n8n workflow returns nothing
- **Fix**: Check your workflow's final response node

#### **HTML Instead of JSON**
- **Symptom**: "Response appears to be HTML"
- **Cause**: n8n error page or wrong URL
- **Fix**: Verify workflow is active and webhook URL is correct

#### **Invalid JSON Format**
- **Symptom**: "JSON parse hatasƒ±"
- **Cause**: Response has syntax errors (trailing commas, etc.)
- **Fix**: Check your workflow's JSON response format

#### **Network/CORS Errors**
- **Symptom**: "Failed to fetch" or CORS error
- **Cause**: n8n not running or CORS not configured
- **Fix**: Ensure n8n is running and CORS headers are set

### 3. üõ†Ô∏è Debugging Steps

1. **Replace script.js with script_with_debug.js** (temporarily)
   ```bash
   # Rename files to switch to debug version
   mv script.js script_backup.js
   mv script_with_debug.js script.js
   ```

2. **Open Browser Console** (F12 ‚Üí Console tab)

3. **Test with a simple command** like "hello"

4. **Look for detailed error messages** in console

### 4. üìã Test Your n8n Workflow

#### Manual Test (via n8n interface):
1. Go to n8n: `http://localhost:5678`
2. Open your workflow
3. Click "Execute Workflow"
4. Send test data: `{"command": "hello", "userId": "test"}`
5. Check if response is valid JSON

#### Test via curl:
```bash
curl -X POST http://localhost:5678/webhook/vault-mk8-command \
  -H "Content-Type: application/json" \
  -d '{"command": "hello", "userId": "test", "sessionId": "123"}'
```

### 5. üîÑ Common Fixes

#### Fix 1: Restart n8n
```bash
# Stop n8n (Ctrl+C if running in terminal)
# Then restart:
npx n8n
```

#### Fix 2: Check Workflow Response Node
Make sure your final "Response Webhook" node has:
- **Content-Type**: `application/json`
- **Response**: Valid JSON format
- **CORS Headers**: `Access-Control-Allow-Origin: *`

#### Fix 3: Verify JSON Response Format
Your workflow should return something like:
```json
{
  "success": true,
  "agent": "chitchat",
  "command": "hello",
  "response": {
    "message": "Hello! How can I help you?",
    "type": "chitchat_response"
  },
  "status": "completed"
}
```

#### Fix 4: Check Node.js Code Blocks
In your workflow's JavaScript code nodes, ensure:
- No `console.log` that returns non-JSON
- Always `return [result]` (array format)
- No undefined variables
- Proper error handling

### 6. üö® Emergency Quick Fix

If nothing works, use the simple test workflow:

1. **Import Simple Test Workflow.json** instead
2. **Change webhook URL** to: `http://localhost:5678/webhook/test-simple`
3. **Update your frontend script.js**:
   ```javascript
   localStorage.setItem('vault_mk8_endpoint', 'http://localhost:5678/webhook/test-simple');
   ```

### 7. üìû Debug Console Commands

**Check current webhook URL:**
```javascript
console.log(localStorage.getItem('vault_mk8_endpoint'));
```

**Change webhook URL:**
```javascript
localStorage.setItem('vault_mk8_endpoint', 'http://localhost:5678/webhook/test-simple');
```

**Clear all stored data:**
```javascript
localStorage.clear();
```

### 8. üìä Expected Working Flow

1. **Frontend sends**: `{"command": "hello", "userId": "vault_frontend_user", "sessionId": "123"}`
2. **n8n receives**: Command gets analyzed
3. **n8n processes**: Routes to appropriate agent
4. **n8n responds**: Valid JSON with success/response structure
5. **Frontend displays**: Formatted message to user

---

## Still Having Issues?

1. **Check the exact error message** in browser console
2. **Verify n8n logs** (terminal where n8n is running)
3. **Test workflow manually** in n8n interface
4. **Compare with working Simple Test Workflow**

---

*Generated by VAULT MK8 Diagnostic System*
