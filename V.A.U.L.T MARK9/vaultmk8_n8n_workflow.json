{
  "name": "VAULT MK9 - Advanced Multi-Agent Command Processor",
  "description": "Intelligent Turkish/English command processor with multi-agent routing and context management (MK9)",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "vault-mk9-command",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "webhook-mk9",
      "name": "ğŸ¯ Command Input Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [20, 300]
    },
    {
      "parameters": {
        "jsCode": "// VAULT MK9 - Advanced Command Processor & Language Detection\nconst inputData = $input.all();\nconst command = inputData[0]?.json?.command || inputData[0]?.json?.body?.command || '';\nconst userId = inputData[0]?.json?.userId || 'anonymous';\nconst sessionId = inputData[0]?.json?.sessionId || Date.now().toString();\n\n// GeliÅŸmiÅŸ pattern eÅŸleÅŸtirme - daha fazla anahtar kelime\nconst turkishPatterns = {\n  ai: ['yaz','analiz','Ã§evir','Ã¶zetle','sor','anlat','aÃ§Ä±kla','deÄŸerlendir','dÃ¼ÅŸÃ¼n','hesapla','metin','paragraf','makale','hikaye','ÅŸiir'],\n  browser: ['google','ara','arama','git','web','site','aÃ§ar','gir','bul','tarama','ziyaret','gÃ¶z at'],\n  system: ['kapat','aÃ§','Ã§alÄ±ÅŸtÄ±r','durdur','listele','sistem','process','kill','baÅŸlat','durum'],\n  file: ['dosya','klasÃ¶r','oluÅŸtur','sil','kopyala','taÅŸÄ±','yaz','oku','kaydet','indir'],\n  api: ['istek','veri','gÃ¶nder','al','api','webhook','servis','Ã§aÄŸÄ±r'],\n  database: ['veritabanÄ±','kayÄ±t','sorgula','gÃ¼ncelle','ekle','db','veri'],\n  chitchat: ['selam','merhaba','gÃ¼naydÄ±n','iyi gÃ¼nler','nasÄ±lsÄ±n','naber','iyi misin','teÅŸekkÃ¼r','saÄŸol','hoÅŸÃ§a kal','gÃ¶rÃ¼ÅŸÃ¼rÃ¼z','iyi geceler','hello','hi','hey']\n};\n\nfunction analyzeCommand(cmd) {\n  const lowerCmd = cmd.toLowerCase();\n  const words = lowerCmd.split(/\\s+/);\n  const agentScores = { ai: 0, browser: 0, system: 0, file: 0, api: 0, database: 0, chitchat: 0 };\n  \n  // Her agent iÃ§in pattern kontrolÃ¼\n  Object.keys(turkishPatterns).forEach(agent => {\n    turkishPatterns[agent].forEach(pattern => {\n      if (lowerCmd.includes(pattern)) {\n        agentScores[agent] += pattern.length * 2; // AÄŸÄ±rlÄ±k artÄ±r\n      }\n    });\n  });\n  \n  // AI iÃ§in varsayÄ±lan: uzun metinler, sorular\n  if (lowerCmd.length > 50 || lowerCmd.includes('?') || lowerCmd.includes('nasÄ±l') || lowerCmd.includes('nedir')) {\n    agentScores.ai += 10;\n  }\n  \n  // Chitchat iÃ§in varsayÄ±lan: kÄ±sa selamlaÅŸmalar\n  if (lowerCmd.length < 15 && (lowerCmd.includes('selam') || lowerCmd.includes('merhaba') || lowerCmd.includes('hello') || lowerCmd.includes('hi'))) {\n    agentScores.chitchat += 20;\n  }\n  \n  // En yÃ¼ksek skorlu agent'Ä± bul\n  let bestAgent = 'ai'; // varsayÄ±lan\n  let maxScore = 0;\n  Object.keys(agentScores).forEach(agent => {\n    if (agentScores[agent] > maxScore) {\n      maxScore = agentScores[agent];\n      bestAgent = agent;\n    }\n  });\n  \n  // EÄŸer hiÃ§bir pattern eÅŸleÅŸmezse AI'ya yÃ¶nlendir\n  if (maxScore === 0) bestAgent = 'ai';\n  \n  return {\n    originalCommand: cmd,\n    detectedLanguage: 'turkish',\n    primaryAgent: bestAgent,\n    confidence: maxScore > 0 ? maxScore / words.length : 0.5,\n    agentScores,\n    timestamp: new Date().toISOString(),\n    sessionId,\n    userId,\n    debug: { command: lowerCmd, scores: agentScores, maxScore, selectedAgent: bestAgent }\n  };\n}\n\nconst analysis = analyzeCommand(command);\nconst executionContext = {\n  ...analysis,\n  executionId: `exec_${Date.now()}`,\n  status: 'routing',\n  metadata: {\n    processingTime: Date.now(),\n    version: 'MK9',\n    workflow: 'multi-agent-processor'\n  }\n};\n\nreturn [executionContext];"
      },
      "id": "analyzer-mk9",
      "name": "ğŸ§  Intelligent Command Analyzer",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "dataType": "string",
        "value1": "={{ $json.primaryAgent }}",
        "rules": {
          "rules": [
            { "value2": "chitchat", "output": 0 },
            { "value2": "ai", "output": 1 },
            { "value2": "browser", "output": 2 },
            { "value2": "system", "output": 3 }
          ]
        },
        "fallbackOutput": 1
      },
      "id": "router-mk9",
      "name": "ğŸ¯ Agent Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [460, 300]
    },
    { 
      "parameters": { 
        "jsCode": "const context = $input.all()[0].json;\nconst cmd = context.originalCommand.toLowerCase();\nconst { spawn } = require('child_process');\n\nlet result = { message: 'Browser komutu iÅŸleniyor...', success: false };\n\ntry {\n  if (cmd.includes('chrome') || cmd.includes('google')) {\n    // Chrome aÃ§ma komutu\n    const chrome = spawn('start', ['chrome'], { shell: true, detached: true });\n    result = { message: 'Google Chrome aÃ§Ä±lÄ±yor...', success: true, action: 'chrome_opened' };\n  } else if (cmd.includes('steam')) {\n    // Steam aÃ§ma komutu\n    const steam = spawn('start', ['steam://'], { shell: true, detached: true });\n    result = { message: 'Steam aÃ§Ä±lÄ±yor...', success: true, action: 'steam_opened' };\n  } else if (cmd.includes('firefox')) {\n    const firefox = spawn('start', ['firefox'], { shell: true, detached: true });\n    result = { message: 'Firefox aÃ§Ä±lÄ±yor...', success: true, action: 'firefox_opened' };\n  } else if (cmd.includes('edge')) {\n    const edge = spawn('start', ['msedge'], { shell: true, detached: true });\n    result = { message: 'Microsoft Edge aÃ§Ä±lÄ±yor...', success: true, action: 'edge_opened' };\n  } else {\n    // Genel web arama\n    const searchQuery = cmd.replace(/google|ara|arama|git|web/gi, '').trim();\n    if (searchQuery) {\n      const search = spawn('start', [`https://www.google.com/search?q=${encodeURIComponent(searchQuery)}`], { shell: true, detached: true });\n      result = { message: `\"${searchQuery}\" iÃ§in Google aramasÄ± baÅŸlatÄ±lÄ±yor...`, success: true, action: 'search_opened' };\n    } else {\n      result = { message: 'Browser komutu tanÄ±mlanamadÄ±. Ã–rnek: \"chrome aÃ§\", \"steam aÃ§\"', success: false };\n    }\n  }\n} catch (error) {\n  result = { message: `Browser hatasÄ±: ${error.message}`, success: false, error: error.message };\n}\n\nreturn [{\n  ...context,\n  agentType: 'browser',\n  status: result.success ? 'completed' : 'error',\n  response: result,\n  metadata: { version: 'MK9', timestamp: new Date().toISOString(), platform: 'windows' }\n}];" 
      }, 
      "id": "browser-mk9", 
      "name": "ğŸŒ Browser Agent Executor", 
      "type": "n8n-nodes-base.code", 
      "typeVersion": 1, 
      "position": [680, 100] 
    },
    { 
      "parameters": { 
        "jsCode": "const context = $input.all()[0].json;\nconst cmd = context.originalCommand.toLowerCase();\nconst { spawn, exec } = require('child_process');\nconst util = require('util');\nconst execPromise = util.promisify(exec);\n\nlet result = { message: 'Sistem komutu iÅŸleniyor...', success: false };\n\ntry {\n  if (cmd.includes('kapat') || cmd.includes('kapat')) {\n    // Uygulama kapatma\n    if (cmd.includes('chrome')) {\n      exec('taskkill /IM chrome.exe /F', (error) => {});\n      result = { message: 'Chrome kapatÄ±lÄ±yor...', success: true, action: 'chrome_killed' };\n    } else if (cmd.includes('steam')) {\n      exec('taskkill /IM steam.exe /F', (error) => {});\n      result = { message: 'Steam kapatÄ±lÄ±yor...', success: true, action: 'steam_killed' };\n    } else {\n      result = { message: 'Hangi uygulamayÄ± kapatmak istiyorsun? Ã–rnek: \"chrome kapat\"', success: false };\n    }\n  } else if (cmd.includes('listele') || cmd.includes('process')) {\n    // Process listesi\n    exec('tasklist | findstr /I \"chrome steam discord\"', (error, stdout) => {\n      const processes = stdout || 'Aktif uygulama bulunamadÄ±';\n      result = { message: `Aktif uygulamalar:\\n${processes}`, success: true, action: 'process_listed', data: processes };\n    });\n    result = { message: 'Aktif uygulamalar listeleniyor...', success: true, action: 'listing_processes' };\n  } else if (cmd.includes('sistem durum')) {\n    // Sistem durumu\n    exec('systeminfo | findstr /I \"Total Physical Memory Available Physical Memory\"', (error, stdout) => {\n      const sysInfo = stdout || 'Sistem bilgisi alÄ±namadÄ±';\n      result = { message: `Sistem Durumu:\\n${sysInfo}`, success: true, action: 'system_info', data: sysInfo };\n    });\n    result = { message: 'Sistem durumu kontrol ediliyor...', success: true, action: 'checking_system' };\n  } else if (cmd.includes('hesap makinesi') || cmd.includes('calc')) {\n    // Hesap makinesi aÃ§\n    spawn('calc', [], { detached: true });\n    result = { message: 'Hesap makinesi aÃ§Ä±lÄ±yor...', success: true, action: 'calc_opened' };\n  } else if (cmd.includes('not defteri') || cmd.includes('notepad')) {\n    // Not defteri aÃ§\n    spawn('notepad', [], { detached: true });\n    result = { message: 'Not defteri aÃ§Ä±lÄ±yor...', success: true, action: 'notepad_opened' };\n  } else if (cmd.includes('gÃ¶rev yÃ¶neticisi') || cmd.includes('task manager')) {\n    // GÃ¶rev yÃ¶neticisi aÃ§\n    spawn('taskmgr', [], { detached: true });\n    result = { message: 'GÃ¶rev yÃ¶neticisi aÃ§Ä±lÄ±yor...', success: true, action: 'taskmgr_opened' };\n  } else {\n    result = { message: 'Sistem komutu tanÄ±mlanamadÄ±. Ã–rnek: \"chrome kapat\", \"hesap makinesi aÃ§\", \"gÃ¶rev yÃ¶neticisi aÃ§\"', success: false };\n  }\n} catch (error) {\n  result = { message: `Sistem hatasÄ±: ${error.message}`, success: false, error: error.message };\n}\n\nreturn [{\n  ...context,\n  agentType: 'system',\n  status: result.success ? 'completed' : 'error',\n  response: result,\n  metadata: { version: 'MK9', timestamp: new Date().toISOString(), platform: 'windows' }\n}];" 
      }, 
      "id": "system-mk9", 
      "name": "âš™ï¸ System Agent Executor", 
      "type": "n8n-nodes-base.code", 
      "typeVersion": 1, 
      "position": [680, 160] 
    },
    { 
      "parameters": { 
        "jsCode": "const context = $input.all()[0].json;\nconst cmd = context.originalCommand;\n\n// Gemini API iÃ§in prompt hazÄ±rla\nconst prompt = `Sen VAULT MK9 AI asistanÄ±sÄ±n. TÃ¼rkÃ§e konuÅŸuyorsun ve kullanÄ±cÄ±nÄ±n komutlarÄ±nÄ± anlayÄ±p yardÄ±mcÄ± oluyorsun. \nKomut: \"${cmd}\"\nBu komut iÃ§in uygun bir yanÄ±t ver:`;\n\nreturn [{\n  ...context,\n  agentType: 'ai',\n  status: 'processing',\n  prompt: prompt,\n  originalCommand: cmd,\n  metadata: { version: 'MK9', timestamp: new Date().toISOString() }\n}];" 
      }, 
      "id": "ai-simple-mk9", 
      "name": "ğŸ¤– AI Agent Executor", 
      "type": "n8n-nodes-base.code", 
      "typeVersion": 1, 
      "position": [680, 220] 
    },
    { "parameters": { "requestMethod": "POST", "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key="apikeyinizigirin"-iCIbnorH9S2NRUv-2AnQ", "sendHeaders": true, "specifyHeaders": "keypair", "headerParameters": { "parameters": [{ "name": "Content-Type", "value": "application/json" }] }, "sendBody": true, "contentType": "json", "jsonBody": "={{ { \"contents\": [{ \"parts\": [{ \"text\": $json.prompt }] }] } }}", "options": {} }, "id": "gemini-api-mk9", "name": "ğŸ§  Gemini API Call", "type": "n8n-nodes-base.httpRequest", "typeVersion": 4, "position": [850, 220] },
    { "parameters": { "jsCode": "const response = $input.all()[0].json; let aiMessage = 'AI response alÄ±ndÄ±'; try { if (response.candidates && response.candidates[0]) { aiMessage = response.candidates[0].content.parts[0].text; } else { aiMessage = 'Gemini API cevabÄ± boÅŸ geldi'; } } catch (e) { aiMessage = 'Gemini API hatasÄ±: ' + e.message; } return [{ agentType: 'ai', status: 'completed', response: { message: aiMessage, data: { rawResponse: response } }, metadata: { version: 'MK9', time: new Date().toISOString() } }];" }, "id": "ai-final-mk9", "name": "ğŸ¤– AI Response Parser", "type": "n8n-nodes-base.code", "typeVersion": 1, "position": [1020, 220] },
    { "parameters": { "jsCode": "return [{...$input.all()[0].json, agentType: 'file', status: 'executing', response: { message: 'File agent Ã§alÄ±ÅŸtÄ±', data: {} }, metadata: { version: 'MK9' } }];" }, "id": "file-mk9", "name": "ğŸ“ File Agent Executor", "type": "n8n-nodes-base.code", "typeVersion": 1, "position": [680, 280] },
    { "parameters": { "jsCode": "return [{...$input.all()[0].json, agentType: 'api', status: 'executing', response: { message: 'API agent Ã§alÄ±ÅŸtÄ±', data: {} }, metadata: { version: 'MK9' } }];" }, "id": "api-mk9", "name": "ğŸ”— API Agent Executor", "type": "n8n-nodes-base.code", "typeVersion": 1, "position": [680, 340] },
    { "parameters": { "jsCode": "return [{...$input.all()[0].json, agentType: 'database', status: 'executing', response: { message: 'Database agent Ã§alÄ±ÅŸtÄ±', data: {} }, metadata: { version: 'MK9' } }];" }, "id": "db-mk9", "name": "ğŸ—„ï¸ Database Agent Executor", "type": "n8n-nodes-base.code", "typeVersion": 1, "position": [680, 400] },
    { "parameters": { "jsCode": "const context = $input.all()[0].json; const cmd = context.originalCommand.toLowerCase(); let msg = 'Merhaba! NasÄ±lsÄ±n?'; if (cmd.includes('hello') || cmd.includes('hi')) { msg = 'Hello! How are you?'; } else if (cmd.includes('gÃ¼naydÄ±n')) { msg = 'GÃ¼naydÄ±n! Ä°yi gÃ¼nler dilerim.'; } else if (cmd.includes('iyi geceler')) { msg = 'Ä°yi geceler! TatlÄ± rÃ¼yalar.'; } return [{ agentType: 'chitchat', status: 'completed', response: { message: msg }, metadata: { version: 'MK9', time: new Date().toISOString() } }];" }, "id": "chitchat-mk9", "name": "ğŸ’¬ Chit-Chat Agent Executor", "type": "n8n-nodes-base.code", "typeVersion": 1, "position": [680, 460] },
    { "parameters": { "mode": "append", "options": {} }, "id": "agg-mk9", "name": "ğŸ”„ Response Aggregator", "type": "n8n-nodes-base.merge", "typeVersion": 3, "position": [1200, 300] },
    { "parameters": { "jsCode": "const allData = $input.all(); const executionResult = allData[0]?.json; return [{ success: true, agent: executionResult?.agentType || 'unknown', status: executionResult?.status || 'completed', response: { message: executionResult?.response?.message || 'Test response' }, metadata: { version: 'MK9', time: new Date().toISOString() } }];" }, "id": "final-mk9", "name": "âœ… Final Response Processor", "type": "n8n-nodes-base.code", "typeVersion": 1, "position": [1420, 300] },
    { "parameters": { "respondWith": "allIncomingItems", "options": { "responseHeaders": { "entries": [ { "name": "Content-Type", "value": "application/json" }, { "name": "Access-Control-Allow-Origin", "value": "*" }, { "name": "Access-Control-Allow-Methods", "value": "POST, GET, OPTIONS" }, { "name": "Access-Control-Allow-Headers", "value": "Content-Type, Authorization" } ] } } }, "id": "resp-mk9", "name": "ğŸ“¤ Response Webhook", "type": "n8n-nodes-base.respondToWebhook", "typeVersion": 1, "position": [1640, 300] }
  ],
  "connections": {
    "ğŸ¯ Command Input Webhook": { "main": [[{ "node": "ğŸ§  Intelligent Command Analyzer", "type": "main", "index": 0 }]] },
    "ğŸ§  Intelligent Command Analyzer": { "main": [[{ "node": "ğŸ¯ Agent Router", "type": "main", "index": 0 }]] },
    "ğŸ¯ Agent Router": { "main": [
      [{ "node": "ğŸ’¬ Chit-Chat Agent Executor", "type": "main", "index": 0 }],
      [{ "node": "ğŸ¤– AI Agent Executor", "type": "main", "index": 0 }],
      [{ "node": "ğŸŒ Browser Agent Executor", "type": "main", "index": 0 }],
      [{ "node": "âš™ï¸ System Agent Executor", "type": "main", "index": 0 }]
    ] },
    "ğŸ’¬ Chit-Chat Agent Executor": { "main": [[{ "node": "ğŸ”„ Response Aggregator", "type": "main", "index": 0 }]] },
    "ğŸ¤– AI Agent Executor": { "main": [[{ "node": "ğŸ§  Gemini API Call", "type": "main", "index": 0 }]] },
    "ğŸ§  Gemini API Call": { "main": [[{ "node": "ğŸ¤– AI Response Parser", "type": "main", "index": 0 }]] },
    "ğŸ¤– AI Response Parser": { "main": [[{ "node": "ğŸ”„ Response Aggregator", "type": "main", "index": 0 }]] },
    "ğŸŒ Browser Agent Executor": { "main": [[{ "node": "ğŸ”„ Response Aggregator", "type": "main", "index": 0 }]] },
    "âš™ï¸ System Agent Executor": { "main": [[{ "node": "ğŸ”„ Response Aggregator", "type": "main", "index": 0 }]] },
    "ğŸ”„ Response Aggregator": { "main": [[{ "node": "âœ… Final Response Processor", "type": "main", "index": 0 }]] },
    "âœ… Final Response Processor": { "main": [[{ "node": "ğŸ“¤ Response Webhook", "type": "main", "index": 0 }]] }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "timezone": "Europe/Istanbul"
  },
  "active": true,
  "tags": [ { "name": "VAULT MK9" } ],
  "triggerCount": 1
}

